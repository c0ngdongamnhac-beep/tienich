<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Square Notes Pro - Full Version</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #818cf8;
            --accent: #c084fc;
            --bg: #0b0f1a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0b0f1a 100%);
            color: #e2e8f0;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        /* --- HEADER & TABS --- */
        header h1 {
            text-align: center; font-weight: 600; letter-spacing: -1px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 15px; font-size: 1.5rem; /* ƒê√£ ch·ªânh nh·ªè ti√™u ƒë·ªÅ */
        }

        .tab-navigation {
            display: flex; justify-content: center; gap: 10px;
            margin-bottom: 30px; flex-wrap: wrap;
        }

        .tab-btn {
            background: var(--card-bg); border: 1px solid var(--border);
            color: #94a3b8; padding: 10px 20px; border-radius: 12px;
            cursor: pointer; transition: 0.3s; font-weight: 600; font-size: 0.9rem;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; border: none; box-shadow: 0 0 15px rgba(129, 140, 248, 0.3);
        }

        .section-content { display: none; }
        .section-content.active { display: block; }

        /* --- UI COMPONENTS --- */
        .input-wrapper {
            max-width: 600px; margin: 0 auto 30px auto;
            background: var(--card-bg); backdrop-filter: blur(12px);
            border: 1px solid var(--border); padding: 20px; border-radius: 20px;
        }

        textarea, .simple-input {
            width: 100%; background: transparent; border: none; color: white;
            font-size: 1rem; outline: none; font-family: inherit;
        }

        /* --- HABIT TRACKER --- */
        .clarity-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; }
        .clarity-section { background: var(--card-bg); padding: 20px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 20px; }
        .clarity-section h2 { font-size: 0.7rem; text-transform: uppercase; color: var(--accent); font-weight: 700; letter-spacing: 1px; }
        
        .habit-row { display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center; margin-bottom: 15px; }
        .habit-name-box { display: flex; flex-direction: column; }
        .habit-name { background: transparent; border: none; color: white; font-size: 0.85rem; outline: none; font-weight: 500; }
        .days-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(12px, 1fr)); gap: 3px; }
        .day-cell { aspect-ratio: 1/1; background: rgba(255,255,255,0.1); border-radius: 2px; cursor: pointer; transition: 0.2s; }
        .day-cell.active { background: var(--primary); box-shadow: 0 0 5px var(--primary); }
        .chart-container { height: 250px; position: relative; }

        /* --- NOTES & FINANCE --- */
        .notes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .note-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 18px; padding: 20px; aspect-ratio: 1/1; display: flex; flex-direction: column; }
        .note-content { flex: 1; overflow-y: auto; font-size: 0.95rem; line-height: 1.5; white-space: pre-wrap; word-break: break-word; }
        
        #toast { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; padding: 10px 20px; border-radius: 12px; display: none; z-index: 1000; font-size: 0.9rem; }

        @media (max-width: 768px) { .clarity-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div id="toast">Th√¥ng b√°o!</div>

<div class="container">
    <header><h1>Square Notes Pro</h1></header>

    <div class="tab-navigation">
        <button class="tab-btn active" onclick="openSection(event, 'notes-section')">üìù Ghi ch√∫</button>
        <button class="tab-btn" onclick="openSection(event, 'clarity-section')">‚ú® Clarity Plan</button>
        <button class="tab-btn" onclick="openSection(event, 'finance-section')">üí∞ Thu chi</button>
        <button class="tab-btn" onclick="openSection(event, 'tasks-section')">‚úÖ C√¥ng vi·ªác</button>
    </div>

    <main id="notes-section" class="section-content active">
        <div class="input-wrapper">
            <textarea id="noteInput" placeholder="Vi·∫øt ghi ch√∫ ho·∫∑c d√°n link t·∫°i ƒë√¢y..." rows="3"></textarea>
            <div class="flex justify-between items-center mt-4 pt-4 border-t border-white/10">
                <span class="text-[10px] text-slate-500 uppercase font-bold">Ctrl + Enter ƒë·ªÉ l∆∞u</span>
                <button class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold transition" onclick="addNote()">L∆ØU TH·∫∫</button>
            </div>
        </div>
        <div class="notes-grid" id="notesGrid"></div>
    </main>

    <main id="clarity-section" class="section-content">
        <div class="flex justify-end mb-4 gap-2">
            <button class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg text-xs font-bold transition" onclick="saveClarity()">L∆ØU K·∫æ HO·∫†CH</button>
        </div>
        <div class="clarity-grid">
            <div class="left-col">
                <div class="clarity-section">
                    <h2>The Big Rock</h2>
                    <input type="text" id="bigRock" class="simple-input text-xl font-bold mt-2" placeholder="M·ª•c ti√™u quan tr·ªçng nh·∫•t...">
                </div>
                <div class="clarity-section">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="m-0">Habit Tracker</h2>
                        <button onclick="addNewHabit()" class="text-[10px] bg-white/10 hover:bg-indigo-500 px-2 py-1 rounded-md transition">+ TH√äM</button>
                    </div>
                    <div id="habit-list"></div>
                </div>
            </div>
            <div class="right-col">
                <div class="clarity-section">
                    <h2>Analytics (%)</h2>
                    <div class="chart-container">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
                <div class="clarity-section">
                    <h2>Ghi ch√∫ nhanh</h2>
                    <textarea id="clarityNotes" class="simple-input mt-2" rows="5" placeholder="Vi·∫øt ghi ch√∫ l·∫≠p k·∫ø ho·∫°ch..."></textarea>
                </div>
            </div>
        </div>
    </main>

    <main id="finance-section" class="section-content">
        <div class="max-w-[600px] mx-auto bg-gradient-to-br from-indigo-600 to-purple-600 p-8 rounded-[25px] text-center mb-8">
            <p class="text-indigo-100 text-sm opacity-80 uppercase font-bold tracking-widest">S·ªë d∆∞ hi·ªán t·∫°i</p>
            <h2 id="balance" class="text-4xl font-bold mt-1 text-white">0‚Ç´</h2>
        </div>
        <div class="input-wrapper">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div class="relative">
                    <input id="amount" type="number" placeholder="S·ªë ti·ªÅn (v√≠ d·ª•: 50)" class="w-full p-3 bg-black/20 border border-white/10 rounded-xl text-white outline-none">
                    <span class="absolute right-4 top-3 text-slate-500 font-bold">.000‚Ç´</span>
                </div>
                <input id="desc" type="text" placeholder="Ghi ch√∫ chi ti√™u..." class="w-full p-3 bg-black/20 border border-white/10 rounded-xl text-white outline-none">
            </div>
            <div class="flex gap-3">
                <button onclick="addTransaction('income')" class="flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 rounded-xl transition">+ THU</button>
                <button onclick="addTransaction('expense')" class="flex-1 bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 rounded-xl transition">- CHI</button>
            </div>
        </div>
        <div id="history" class="max-w-xl mx-auto space-y-3"></div>
    </main>

    <main id="tasks-section" class="section-content">
        <div class="input-wrapper max-w-xl">
            <div class="flex gap-2">
                <input id="taskInput" type="text" placeholder="B·∫°n c·∫ßn l√†m g√¨?" class="flex-1 p-3 bg-black/20 border border-white/10 rounded-xl text-white outline-none">
                <button onclick="addTask()" class="bg-indigo-500 px-6 rounded-xl font-bold">TH√äM</button>
            </div>
        </div>
        <div id="taskList" class="max-w-xl mx-auto space-y-3"></div>
    </main>
</div>

<script>
    // --- STATE ---
    let myChart;
    let habits = [
        { name: 'ƒê·ªçc s√°ch', checks: Array(31).fill(false) },
        { name: 'T·∫≠p th·ªÉ d·ª•c', checks: Array(31).fill(false) },
        { name: 'H·ªçc code', checks: Array(31).fill(false) },
        { name: 'Thi·ªÅn', checks: Array(31).fill(false) }
    ];

    // --- TABS ---
    function openSection(evt, sectionId) {
        document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        evt.currentTarget.classList.add('active');
        if(sectionId === 'clarity-section' && myChart) myChart.update();
    }

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        displayNotes();
        updateFinanceUI();
        renderTasks();
        initClarity();
    });

    // --- CLARITY LOGIC ---
    function initClarity() {
        const saved = JSON.parse(localStorage.getItem('clarity_v3'));
        if (saved) {
            document.getElementById('bigRock').value = saved.bigRock || '';
            document.getElementById('clarityNotes').value = saved.notes || '';
            if(saved.habits) habits = saved.habits;
        }
        renderHabits();
        renderChart();
    }

    function renderHabits() {
        const container = document.getElementById('habit-list');
        container.innerHTML = habits.map((habit, idx) => `
            <div class="habit-row">
                <div class="habit-name-box">
                    <input type="text" class="habit-name" value="${habit.name}" onchange="updateHabitName(${idx}, this.value)">
                    <button onclick="deleteHabit(${idx})" class="text-[8px] text-left text-slate-600 hover:text-rose-400 font-bold uppercase">X√≥a</button>
                </div>
                <div class="days-grid">
                    ${habit.checks.map((c, dIdx) => `
                        <div class="day-cell ${c ? 'active' : ''}" onclick="toggleHabitDay(${idx}, ${dIdx})"></div>
                    `).join('')}
                </div>
            </div>
        `).join('');
    }

    function addNewHabit() {
        const name = prompt("T√™n th√≥i quen m·ªõi:");
        if (!name) return;
        habits.push({ name: name, checks: Array(31).fill(false) });
        renderHabits();
        updateChart();
        saveClarity();
    }

    function deleteHabit(idx) {
        if (confirm("X√≥a th√≥i quen n√†y?")) {
            habits.splice(idx, 1);
            renderHabits();
            updateChart();
            saveClarity();
        }
    }

    function toggleHabitDay(hIdx, dIdx) {
        habits[hIdx].checks[dIdx] = !habits[hIdx].checks[dIdx];
        renderHabits();
        updateChart();
    }

    function updateHabitName(idx, val) {
        habits[idx].name = val;
        updateChart();
    }

    function renderChart() {
        const ctx = document.getElementById('myChart').getContext('2d');
        const colors = ['#818cf8', '#c084fc', '#34d399', '#fb7185', '#fbbf24', '#22d3ee'];
        myChart = new Chart(ctx, {
            type: 'polarArea',
            data: {
                labels: habits.map(h => h.name),
                datasets: [{
                    data: habits.map(h => (h.checks.filter(c => c).length / 31 * 100).toFixed(0)),
                    backgroundColor: habits.map((_, i) => colors[i % colors.length] + '80'),
                    borderWidth: 0
                }]
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                scales: { r: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { display: false } } },
                plugins: { legend: { labels: { color: '#94a3b8', font: { size: 10 } } } }
            }
        });
    }

    function updateChart() {
        myChart.data.labels = habits.map(h => h.name);
        myChart.data.datasets[0].data = habits.map(h => (h.checks.filter(c => c).length / 31 * 100).toFixed(0));
        myChart.data.datasets[0].backgroundColor = habits.map((_, i) => ['#818cf8', '#c084fc', '#34d399', '#fb7185'][i % 4] + '80');
        myChart.update();
    }

    function saveClarity() {
        const data = { bigRock: document.getElementById('bigRock').value, notes: document.getElementById('clarityNotes').value, habits: habits };
        localStorage.setItem('clarity_v3', JSON.stringify(data));
        showToast("ƒê√£ l∆∞u k·∫ø ho·∫°ch!");
    }

    // --- NOTES LOGIC ---
    function addNote() {
        const input = document.getElementById('noteInput');
        if (!input.value.trim()) return;
        const note = { id: Date.now(), text: input.value.trim(), date: new Date().toLocaleDateString('vi-VN') };
        const notes = JSON.parse(localStorage.getItem('square-notes') || '[]');
        notes.unshift(note);
        localStorage.setItem('square-notes', JSON.stringify(notes));
        input.value = "";
        displayNotes();
    }

    function displayNotes() {
        const notes = JSON.parse(localStorage.getItem('square-notes') || '[]');
        const grid = document.getElementById('notesGrid');
        grid.innerHTML = notes.map(note => `
            <div class="note-card">
                <div class="note-content">${linkify(note.text)}</div>
                <div class="flex justify-between items-center mt-4 text-[10px] text-slate-500 font-bold">
                    <span>${note.date}</span>
                    <div class="flex gap-2">
                        <button class="hover:text-indigo-400" onclick="copyNote(\`${note.text.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)">COPY</button>
                        <button class="hover:text-rose-500" onclick="deleteItem('note', ${note.id})">X√ìA</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function linkify(text) {
        const urlPattern = /(\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
        return text.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]))
                   .replace(urlPattern, url => `<a href="${url}" target="_blank" class="text-indigo-400 hover:underline">${url}</a>`);
    }

    // --- FINANCE LOGIC ---
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    function addTransaction(type) {
        const amountInput = document.getElementById('amount');
        const descInput = document.getElementById('desc');
        let val = parseFloat(amountInput.value);
        if (!val || !descInput.value) return showToast("Nh·∫≠p ƒë·ªß ti·ªÅn v√† n·ªôi dung!");
        transactions.unshift({ id: Date.now(), amount: type === 'expense' ? -(val * 1000) : (val * 1000), desc: descInput.value, date: new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'}) });
        localStorage.setItem('transactions', JSON.stringify(transactions));
        amountInput.value = ''; descInput.value = '';
        updateFinanceUI();
    }

    function updateFinanceUI() {
        const history = document.getElementById('history');
        const balanceEl = document.getElementById('balance');
        let total = 0;
        history.innerHTML = transactions.map(t => {
            total += t.amount;
            return `
                <div class="flex justify-between items-center bg-white/5 p-4 rounded-xl border border-white/10">
                    <div><p class="font-semibold text-slate-200">${t.desc}</p><p class="text-[10px] text-slate-500">${t.date}</p></div>
                    <div class="flex items-center gap-3">
                        <span class="font-bold ${t.amount > 0 ? 'text-emerald-400' : 'text-rose-400'}">${t.amount.toLocaleString()}‚Ç´</span>
                        <button onclick="deleteItem('trans', ${t.id})" class="text-slate-600 hover:text-white">‚úï</button>
                    </div>
                </div>`;
        }).join('');
        balanceEl.innerText = total.toLocaleString() + '‚Ç´';
    }

    // --- TASKS ---
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    function addTask() {
        const input = document.getElementById('taskInput');
        if (!input.value) return;
        tasks.unshift({ id: Date.now(), text: input.value, done: false });
        localStorage.setItem('tasks', JSON.stringify(tasks));
        input.value = '';
        renderTasks();
    }

    function renderTasks() {
        const list = document.getElementById('taskList');
        list.innerHTML = tasks.map(t => `
            <div class="flex justify-between items-center bg-white/5 p-4 rounded-xl border border-white/10">
                <div onclick="toggleTask(${t.id})" class="flex items-center gap-3 cursor-pointer">
                    <div class="w-5 h-5 border-2 rounded-full ${t.done ? 'bg-indigo-500 border-indigo-500' : 'border-slate-500'}"></div>
                    <span class="${t.done ? 'line-through text-slate-500' : 'text-slate-200'}">${t.text}</span>
                </div>
                <button onclick="deleteItem('task', ${t.id})" class="text-slate-600 hover:text-rose-500">‚úï</button>
            </div>
        `).join('');
    }

    function toggleTask(id) {
        tasks = tasks.map(t => t.id === id ? {...t, done: !t.done} : t);
        localStorage.setItem('tasks', JSON.stringify(tasks));
        renderTasks();
    }

    // --- HELPERS ---
    function deleteItem(type, id) {
        if (type === 'note') {
            let n = JSON.parse(localStorage.getItem('square-notes') || '[]').filter(x => x.id !== id);
            localStorage.setItem('square-notes', JSON.stringify(n));
            displayNotes();
        } else if (type === 'trans') {
            transactions = transactions.filter(t => t.id !== id);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            updateFinanceUI();
        } else {
            tasks = tasks.filter(t => t.id !== id);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }
        showToast("ƒê√£ x√≥a!");
    }

    function copyNote(text) { navigator.clipboard.writeText(text).then(() => showToast("ƒê√£ sao ch√©p!")); }
    function showToast(msg) {
        const toast = document.getElementById('toast');
        toast.innerText = msg; toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 2000);
    }

    document.getElementById('noteInput').addEventListener('keydown', e => {
        if (e.ctrlKey && e.key === 'Enter') addNote();
    });
</script>
</body>
</html>
